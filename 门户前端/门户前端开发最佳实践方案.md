

[TOC]



### ğŸ”¥ ç›®å½•ç»“æ„

```
epp-project
â”œâ”€â”€ <å„ç±»é…ç½®æ–‡ä»¶>
â”œâ”€â”€ _mock/
â”œâ”€â”€ scripts/
â””â”€â”€ src/
 Â Â  â”œâ”€â”€ app/
 Â Â  â”‚Â Â  â”œâ”€â”€ core/
 Â Â  â”‚   â”‚Â Â  â””â”€â”€ startup.service.ts
 Â Â  â”‚Â Â  â”œâ”€â”€ layout/
 Â Â  â”‚   â”‚Â Â  â”œâ”€â”€ default/
 Â Â  â”‚   â”‚Â Â  â””â”€â”€ fullscreen/
 Â Â  â”‚Â Â  â”œâ”€â”€ routes/
 Â Â  â”‚   â”‚Â Â  â”œâ”€â”€ home/
 Â Â  â”‚   â”‚Â Â  â””â”€â”€ news/
 Â Â  â”‚Â Â  â”œâ”€â”€ shared/
 Â Â  â”‚Â Â  â”œâ”€â”€ app.component.ts
 Â Â  â”‚Â Â  â”œâ”€â”€ app.module.ts
 Â Â  â”‚Â Â  â””â”€â”€ global-config.module.ts
 Â Â  â”œâ”€â”€ assets/
 Â Â  â”œâ”€â”€ environments/
 Â Â  â”œâ”€â”€ styles/
 Â Â  â”œâ”€â”€ index.html
 Â Â  â”œâ”€â”€ main.ts
 Â Â  â”œâ”€â”€ styles.less
 Â Â  â””â”€â”€ styles.scss

```

çº¦å®šç›®å½•:

- `_mock` å­˜æ”¾ mock [è§„åˆ™æ•°æ®](https://ng-alain.com/mock/rule/zh)ï¼Œå…·ä½“è§æ¨¡æ‹Ÿæ•°æ®ã€‚
- `scripts/**` é¡¹ç›®è‡ªç”¨çš„å·¥å…· nodeã€bash ç­‰å„ç±»è„šæœ¬ã€‚
- `src/app/core/**` ç”¨äº**åº”ç”¨å…¨å±€é…ç½®/æœåŠ¡**ï¼Œå¦‚åˆå§‹åŒ–é¡¹ç›®é…ç½®ã€HTTPæ‹¦æˆªå™¨é…ç½®ã€‚
- `src/app/layout/**` **å¸ƒå±€**ç»„ä»¶ã€æ¨¡å—ï¼ˆæ ¹çº§è·¯ç”±å‡ºå£ç»„ä»¶ï¼‰ã€‚
- `src/app/routes/**` **è·¯ç”±é¡µé¢**ç»„ä»¶ã€æ¨¡å—ã€‚
- `src/app/shared/**` `sharedModules`ï¼Œè·¨é¡µé¢ã€é«˜å¤ç”¨æ€§çš„**å…¬å…±ç»„ä»¶ã€æ¨¡å—**ã€‚è‡ªå®šä¹‰ Repositoryã€è‡ªå®šä¹‰ç»„ä»¶ã€æŒ‡ä»¤éƒ½åœ¨è¿™ã€‚
- `src/app/app.module.ts` å’Œ `app.component.ts` æ˜¯ Angular é¡¹ç›®çš„**æ ¹æ¨¡å—ã€æ ¹ç»„ä»¶**ã€‚
- `src/assets/**` é™æ€èµ„æºã€‚
- `src/environments/**` åº”ç”¨ç¯å¢ƒå˜é‡ã€‚
- `src/styles/**` **å…¬å…±æˆ–ä¸»é¢˜æ ·å¼æ–‡ä»¶**ã€‚
- `styles.less` å’Œ `styles.scss` å…¬å…±æˆ–ä¸»é¢˜æ ·å¼çš„ç¼–è¯‘å…¥å£æ–‡ä»¶ã€‚



### æ”¯æŒç‰¹æ€§

|                  | ç›¸å…³æ–‡ä»¶/ç›®å½•/æ¨¡å—                |      |
| ---------------- | --------------------------------- | ---- |
| å‰ç«¯é…ç½®æ–‡ä»¶     | app-data.json, startup.service.ts |      |
| ç»„ä»¶å±æ€§å…¨å±€é…ç½® | global-config.module.ts           |      |
| æƒ°æ€§åŠ è½½è·¯ç”±     | route-routing.ts, src/app/route/  |      |
| å›½é™…åŒ–           | core.module.ts                    |      |
| å¤šæ ‡ç­¾           |                                   |      |
| Mock å‡æ•°æ®      | global-config.module.ts, _mock/   |      |
| å‰ç«¯æƒé™æ§åˆ¶     | @ihulk/acl                        |      |
| æ¢è‚¤/å¤šä¸»é¢˜      | src/app/style/                    |      |
| è¯·æ±‚å“åº”æ‹¦æˆªå™¨   | src/app/core/net/, core.module.ts |      |



### Routes

æ¯ä¸ªå¼‚æ­¥è·¯ç”±é¡µé¢éƒ½éµå¾ªç±»ä¼¼çš„ç»“æ„ï¼š

```tree
â””â”€â”€ src/
 Â Â  â”œâ”€â”€ app/
 Â Â  â”‚Â Â  â”œâ”€â”€ routes/
 Â Â  â”‚   â”‚Â Â  â”œâ”€â”€ home/
 Â Â  â”‚Â Â  â”‚   â”‚   â”œâ”€â”€ <é¡µé¢ç»„ä»¶>/
 Â Â  â”‚Â Â  â”‚   â”‚   â”œâ”€â”€ <å…¶ä»–ç»„ä»¶>/
 Â Â  â”‚Â Â  â”‚   â”‚   â”œâ”€â”€ home-routing.module.ts
 Â Â  â”‚   â”‚Â Â  â”‚   â””â”€â”€ home.module.ts
```

å¼‚æ­¥è·¯ç”±åœ¨ `route-routing.module.ts` ä¸­æ³¨å†Œã€‚

ç›®çš„æ˜¯æ‹†åˆ† JS æ–‡ä»¶ï¼Œæé«˜é¡µé¢åŠ è½½é€Ÿåº¦ï¼Œè¯¦æƒ…è§ [Angular æ–‡æ¡£ - å¼‚æ­¥è·¯ç”±](https://angular.cn/guide/router#milestone-6-asynchronous-routing)ã€‚



### Layout

layout ç»„ä»¶ç”¨ä½œè·¯ç”±è·¯å¾„ä¸­çš„æŸä¸€çº§ï¼Œç»™å½“å‰è·¯ç”±é¡µé¢å†…çš„ç»„ä»¶æä¾›ç»„åˆæ–¹å¼ã€‚

è¿™æ ·å¯ä»¥å°†å¸ƒå±€æ–¹å¼ä½“ç°åœ¨è·¯ç”±è·¯å¾„ä¸­ï¼Œæ›´æ”¹é¡µé¢ URL å°±èƒ½æ›´æ¢å¸ƒå±€æ–¹å¼ã€‚



### Core

Angular 8.0 ä¹‹å‰ä½œä¸ºå…¨å±€å•ä¾‹æœåŠ¡çš„æ³¨å†Œ Module å‡ºç°åœ¨å®˜æ–¹æœ€ä½³å®è·µä¸­ï¼Œåæ¥çš„ç‰ˆæœ¬ä¸­å»æ‰äº†ã€‚åŸå› æ˜¯å…¨å±€å•ä¾‹æœåŠ¡æ›´å¥½çš„æ³¨å†Œæ–¹å¼æ˜¯ `@Injectable({ providedIn: 'xx' })`ï¼Œè¯¦æƒ…è§ä¾èµ–æ³¨å…¥ã€‚

ä½†å®ƒä¾ç„¶æœ‰ä¸å¯æ›¿ä»£çš„ä½œç”¨ï¼Œæ¯”å¦‚ç»™å…¨å±€é…ç½®é¡¹/æä¾›å€¼ï¼Œä¾ç„¶åªèƒ½é€šè¿‡ `@NgModule` çš„ `providers`ï¼Œä¾‹å¦‚ `APP_INITIALIZER`(åº”ç”¨åˆå§‹åŒ–å™¨) å’Œ `HTTP_INTERCEPTORS`(HTTP æ‹¦æˆªå™¨):

```typescript
@NgModule({
  providers: [
    // startup
    StartupService,
    {
      provide: APP_INITIALIZER,
      useFactory: StartupServiceFactory,
      deps: [StartupService],
      multi: true,
    },
    // interceptors
    { provide: HTTP_INTERCEPTORS, useClass: DefaultInterceptor, multi: true }
  ],
})
```

æ‰€æœ‰ä¾èµ– Token æä¾›çš„å…¨å±€æœåŠ¡éƒ½åº”è¯¥åœ¨æ­¤æ³¨å†Œã€‚



### SharedModule

æŠŠéœ€è¦å››å¤„å¯¼å…¥çš„æ¨¡å—ï¼Œé›†ä¸­åœ¨ SharedModule ä¸­å¯¼å‡ºï¼Œåœ¨éœ€è¦çš„åœ°æ–¹å¯ç›´æ¥å¯¼å…¥ SharedModuleï¼Œå¤ç”¨é«˜é¢‘æ¨¡å—çš„å¯¼å…¥ã€‚

è‡ªå®šä¹‰å…¬å…±ç»„ä»¶ä¹Ÿå¯ä»¥æ”¾åœ¨ shared/ ç›®å½•ä¸‹ã€‚ä½†åº”å½“è€ƒè™‘æ˜¯å¦é€šè¿‡ SharedModule å¯¼å‡ºï¼š

1. è‹¥ç»„ä»¶ä½“ç§¯å¾ˆå°ï¼Œæˆ–é€šç”¨ç¨‹åº¦ä¸é«˜ï¼Œæ²¡æœ‰è¿›ä¸€æ­¥æŠ½è±¡çš„å¿…è¦ï¼Œåˆ™å¯ç›´æ¥å®šä¹‰åœ¨ SharedModule ä¸­ï¼Œå¹¶å¯¼å‡ºã€‚
2. è‹¥ç»„ä»¶ä½“ç§¯å¾ˆå¤§ï¼Œæˆ–å¤ç”¨æ€§å¼ºã€å¯ä»¥æŠ½ç¦»å°è£…ä¸ºè·¨åº”ç”¨ä½¿ç”¨çš„å…¬å…±ç»„ä»¶ï¼Œåˆ™åº”ä¸ºç»„ä»¶åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„ NgModuleï¼Œä½œä¸ºæ•´ä½“ï¼Œä¸ä¸ SharedModule  æœ‰è€¦åˆå…³ç³»ã€‚ä¾ç„¶å¯ä»¥æŒ‰éœ€åœ¨ SharedModule ä¸­å¯¼å‡ºè¿™ä¸ªæ–°æ¨¡å—ã€‚

SharedModule ä¸­ä¸å…è®¸æ³¨å†ŒæœåŠ¡ï¼Œå¦åˆ™å¯¼å…¥å®ƒçš„æ‡’åŠ è½½æ¨¡å—ï¼Œä¼šç»™æœåŠ¡ç”Ÿæˆä¸€ä¸ªå•ç‹¬å®ä¾‹ï¼Œè€Œä¸æ˜¯å…±äº«åº”ç”¨æ ¹éƒ¨çš„å•ä¾‹æœåŠ¡ã€‚è¯¦æƒ…è§ä¾èµ–æ³¨å…¥ã€‚



### ğŸ’¥ æ ¸å¿ƒæ¨¡å—å¯¼å…¥å…³ç³»

> - æœ‰çš„æ¨¡å—è¢«é¢‘ç¹å¯¼å…¥è¿›å…¶ä»–ä¸šåŠ¡æ¨¡å—ï¼Œä¼šä¸ä¼šå¯¼è‡´ç¼–è¯‘å‡ºé‡å¤ä»£ç ã€ä½“ç§¯è¿‡å¤§ï¼Ÿ
> - æ˜¯å¦å¯ä»¥ç»™æ ¹æ¨¡å—ï¼ˆå¦‚ AppModuleï¼‰å¯¼å…¥å¸¸ç”¨ç»„ä»¶ï¼Œè®©å­æ¨¡å—ç»§æ‰¿è¿™äº›ç»„ä»¶ï¼Œä»è€Œé¿å…é‡å¤å¯¼å…¥ï¼Ÿ
> - æ—¢ç„¶ `SharedModule`  è¿™ä¹ˆæ–¹ä¾¿ï¼Œå¯ä¸å¯ä»¥æŠŠæ‰€æœ‰ç¬¬ä¸‰æ–¹ç»„ä»¶å…¨éƒ¨é€šè¿‡å®ƒå¯¼å‡º?
1. **è¦ç”¨å“ªä¸ª moduleï¼Œå°±åœ¨å½“å‰ module å¯¼å…¥å“ªä¸ª moduleã€‚**[Angular NgModule çš„å…³ç³»]()ã€‚æ¨¡å—å’Œæ¨¡å—ä¹‹é—´æ— è®ºå“ªç§ç»„åˆï¼Œéƒ½æ²¡æœ‰ç»§æ‰¿å…³ç³»ã€‚æ‰€ä»¥ `AppModule` é‡Œå¼•å…¥çš„ Moduleï¼Œä¸èƒ½åœ¨å­è·¯ç”± module æˆ–ç›´æ¥å¼•å…¥çš„ module é‡Œä½¿ç”¨ã€‚
2. å‡ ä¹åœ¨æ¯ä¸ªæ¨¡å—éƒ½è¦ç”¨åˆ°çš„é«˜é¢‘ç»„ä»¶/NgModuleï¼Œå†™è¿› **SharedModules** çš„ exports æ•°ç»„ã€‚
3. ä½é¢‘ä½¿ç”¨ï¼ˆä¸æ˜¯æ¯ä¸ªé¡µé¢éƒ½ç”¨åˆ°ï¼‰çš„**ç¬¬ä¸‰æ–¹æ¨¡å—**ï¼Œåœ¨å½“å‰å¼‚æ­¥è·¯ç”±æ¨¡å—ä¸­å•ç‹¬ importã€‚[Angular å¼‚æ­¥è·¯ç”±æ‰“åŒ…æœºåˆ¶]()

![1595234766595](é—¨æˆ·å‰ç«¯å¼€å‘æœ€ä½³å®è·µæ–¹æ¡ˆ.assets/1595234766595.png)

#### å…³äº `NgModule`

1. declarations å†…çš„æ‰å«â€œ*å½“å‰æ¨¡å—çš„ç»„ä»¶*â€ï¼Œè€Œä¸æ˜¯è·Ÿè¿™ä¸ª module åœ¨åŒä¸€ç›®å½•çš„å°±æ˜¯ï¼›

2. imports æ˜¯ç»™*å½“å‰æ¨¡å—çš„ç»„ä»¶*å¯¼å…¥ä¾èµ–ï¼Œä¸ export æ¯«æ— å…³ç³»ï¼›

3. exports å¯ä»¥å¯¼å‡ºä¸¤ç§ä¸œè¥¿ï¼š

   1. *å½“å‰æ¨¡å—çš„ç»„ä»¶*ã€‚
   2. ä»»æ„å…¶ä»–æ¨¡å—ï¼Œä¸”ä¸éœ€è¦åœ¨ imports ä¸­å¯¼å…¥ï¼Œä»…éœ€ ES6 å¯¼å…¥ã€‚

4. ä»»æ„ä¸¤ä¸ª NgModule åªæœ‰ä¸¤ç§å…³ç³»ï¼š

   1. ç›´æ¥å¯¼å…¥
   2. æƒ°æ€§åŠ è½½

   **ä½†æ˜¯ä¸è®ºå“ªç§å…³ç³»ï¼Œæ¨¡å—é—´éƒ½ä¸ä¼šç»§æ‰¿ç»„ä»¶**ï¼Œæ¯”å¦‚ â€œA æ¨¡å—çš„ç»„ä»¶å¯ä»¥åœ¨å­æ¨¡å— B ä¸­ä½¿ç”¨â€ï¼Œä¸å­˜åœ¨çš„ã€‚



### ğŸ’¥ ä¾èµ–æ³¨å…¥

> æ³¨å†ŒæœåŠ¡æœ‰å“ªäº›æ–¹å¼ï¼Ÿé‡å¤æ³¨å†ŒæœåŠ¡ä¼šæ€æ ·ï¼Œæœ‰åå¤„å—ï¼Ÿ
>
> Injectorï¼ˆæ³¨å…¥å™¨ï¼‰å®ä¾‹ä¼šç”Ÿæˆå‡ ä¸ªï¼Ÿè·Ÿ `NgModule` æœ‰ä»€ä¹ˆæ•°é‡å…³ç³»ï¼Ÿ1 å¯¹ 1 å—ï¼Ÿ
>
> `forRoot()` æ˜¯å¹²ä»€ä¹ˆç”¨çš„ï¼Ÿ
>
> å¦‚ä½•ä¿è¯ä¸€ä¸ªæœåŠ¡æ˜¯å•ä¾‹ï¼Ÿå¦‚ä½•åœ¨æŸèŒƒå›´å†…å¾—åˆ°ä¸€ä¸ªæ–°å®ä¾‹ï¼Ÿ

æ³¨å†ŒæœåŠ¡çš„å‡ ç§æ–¹å¼:

| æ³¨å†Œæ–¹å¼                                  | å¯æ ‘æ‘‡å¦ï¼Ÿ | å¯æ³¨å…¥èŒƒå›´ï¼Ÿ | ä½¿ç”¨æ–¹éœ€è¦åšä»€ä¹ˆï¼Ÿ | Injector ç±»å‹ï¼Ÿ  |
| ----------------------------------------- | ---------- | ------------ | ------------------ | ---------------- |
| `@Injectable({ providedIn: 'root' })`     | æ˜¯         | å¤„å¤„å¯æ³¨     | å•¥éƒ½ä¸ç”¨åš         | Module Injector  |
| `@Injectable({ providedIn: XxxModule })`  | æ˜¯         | å¤„å¤„å¯æ³¨     | éœ€è¦å¯¼å…¥ XxxModule | Module Injector  |
| `@NgModule({ providers: [XxxService] })`  | x          | å¤„å¤„å¯æ³¨     | éœ€è¦å¯¼å…¥ XxxModule | Module Injector  |
| `@Component({ providers: [XxxService] })` | x          | ä»…å½“å‰ç»„ä»¶   | è‡ªè¡Œæ³¨å†Œ           | Element Injector |

æ³¨æ„ Module Injector å’Œ Element Injector å®Œå…¨æ˜¯ä¸¤æ¡çº¿ï¼š



æ¯ä¸ªæ³¨å…¥å™¨éƒ½ä¼š

ä¸€èˆ¬æƒ…å†µä¸‹å¾—åˆ°çš„æœåŠ¡éƒ½æ˜¯å•ä¾‹ã€‚å¾—åˆ°éå•ä¾‹çš„åŠæ³•ï¼š

1. åœ¨å¼‚æ­¥è·¯ç”±æ¨¡å—ä¸­æ³¨å†ŒæœåŠ¡
2. åœ¨ Element

é‡å¤æ³¨å†Œä¸€èˆ¬æ²¡å…³ç³»



### ğŸ”¥ Repository

è·å–æœåŠ¡ç«¯æ•°æ®ä½¿ç”¨ `XxxRepository`ã€‚åº”æŒ‰ç…§åˆ†ç±»æ‹†åˆ†å¤šä¸ªç‹¬ç«‹çš„ `Repository` ï¼Œè€Œä¸æ˜¯éƒ½å†™åœ¨ä¸€ä¸ªé‡Œã€‚

ä¸€ä¸ªå…¸å‹çš„ Repository ä¾‹å­ï¼š

```typescript
import { HttpClient } from '@angular/common/http';
import { Injectable } from '@angular/core';

export const URLS_COLUMN = {
  columnContentList: '/api/columncontent/filter/column/id/paged',
}
/**
 * æ ç›®ç›¸å…³è¯·æ±‚
 */
@Injectable({ providedIn: 'root' })
export class ColumnRepository {
  constructor(
    private http: HttpClient
  ) {}

  getContentListByColumnId(columnId: string, pageIndex = '1', pageSize = '10') {
    return this.http.get<any>(URLS.columnContentList, {
      params: {
        columnId,
        number: pageIndex,
        size: pageSize
      }
    })
  }
}

```

URLS å»ºè®®æ”¾å…¥å¯¹åº”çš„ Repository æ–‡ä»¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å•ä¸ªå¸¸é‡ä¹Ÿå¯ç”¨å¯¹è±¡åŒ…è£¹ï¼š

```typescript
// å¯ä»¥å•ä¸ªå¸¸é‡âœ…
const FIND_DEFAULT_APP_CONFIG = '/api/file/appconfig/findDefaultConfig'
const SINGLE_IMG_UPLOAD = '/api/image/single/upload'
const IMAGE_COMPRESSED = '/api/image/web/compressed/'

// ä¹Ÿå¯ä»¥å¯¹è±¡åŒ…è£¹âœ…
const URLS_COLUMN = {
    FindDefaultAppConfig: '/api/file/appconfig/findDefaultConfig',
    SingleImageUpload: '/api/image/single/upload',
    ImageCompressed: '/api/image/web/compressed/',
}
```



### â­ æ ·å¼ã€æ¢è‚¤

- @import è·¯å¾„å†™æ³•

### å®ä½“ç±»å‹

### å†™äº†ä¸€ä¸ªå…¬å…±å†…å®¹æ”¾åœ¨å“ª

æ‹†åˆ†ç»„ä»¶ã€æŒ‡ä»¤ã€æœåŠ¡ã€ç®¡é“æ—¶ï¼Œè€ƒè™‘å½“å‰åŠŸèƒ½æ˜¯å¦å…¬å…±ã€‚

è‹¥æ˜¯ï¼Œæ€è€ƒã€å°è£…ä¸ºå…¬å…±ç»„ä»¶ï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼ç»™å¤–éƒ¨æš´éœ²æ¥å£ï¼š

1. @Input()
2. @Output()
3. pubilc æ–¹æ³•

### ihulk

å…¬å…±å†…å®¹æ”¾å…¥ @ihulk\xxx ï¼Œå·¥ç¨‹åœ°å€

| ç»„ä»¶/æœåŠ¡      | æè¿°                         |      |
| -------------- | ---------------------------- | ---- |
| å†…å®¹ç¼–è¾‘å™¨é¡µé¢ | å¯Œæ–‡æœ¬ã€æ–‡ç« ä¿¡æ¯ç¼–è¾‘å…¬å…±é¡µé¢ |      |
| è¯„è®º           | è¯„è®ºåˆ—è¡¨ã€å‘å¸ƒç¼–è¾‘å™¨         |      |
| æ–‡ä»¶é¢„è§ˆ       | å¸¸ç”¨æ ¼å¼æ–‡ä»¶é¢„è§ˆé¡µé¢/å¼¹çª—    |      |
| Repository     | æŒä¹…åŒ–æ•°æ®å­˜å–               |      |



### å‘½å

### å…¨å±€é…ç½®æœºåˆ¶

### æ¨¡æ‹Ÿæ•°æ®

- 

### å›¾æ ‡ã€svg



## åº“å¼€å‘

ä½ç½®ï¼š`packages/<ä¸€çº§åº“å>/<äºŒçº§åº“å>/`

ä¸€çº§åº“ `@ihulk/portal` ç›®å½•ç»“æ„ï¼š

```
portal.module.ts // é›†ä¸­å¯¼å‡ºçš„ ng æ¨¡å—
public_api.ts // é›†ä¸­å¯¼å‡º es æ¨¡å—
package.json // npm åŒ…ä¿¡æ¯
ng-package.json // ng-packager ng é…ç½®
tsconfig.lib.json // ng-packager ts é…ç½®
tsconfig.json // ç¼–è¾‘å™¨ ts è®¾ç½®
index.ts // å…¥å£
README.md // è‡ªè¿°æ–‡ä»¶
```

















### å‚è€ƒèµ„æ–™ï¼š

- [Angular - ä»£ç é£æ ¼æŒ‡å—](https://angular.cn/guide/styleguide#file-tree)

- [ng-alain - æ¨¡å—æ³¨å†ŒæŒ‡å¯¼åŸåˆ™](https://github.com/ng-alain/ng-alain/issues/180)

- [å¦‚ä½•æ›´å¥½åœ°ç»„ç»‡Angularé¡¹ç›®](https://zhuanlan.zhihu.com/p/63515048)



